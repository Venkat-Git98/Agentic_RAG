graph TD;
    A["Start<br/>User Query"] --> B["Triage<br/>Classifies the user's request"];
    B -- "Simple or Rejected" --> Z["End<br/>Provide direct answer"];
    B -- "Complex Query" --> C["Planning<br/>Create a step-by-step plan"];
    
    C --> D["Research<br/>Gather information using multiple tools"];
    
    subgraph "Thinking & Synthesis"
        direction TB
        D --> E["Validation<br/>Check if gathered data is sufficient"];
        E -- "Needs Calculation" --> F["Calculation<br/>Perform mathematical operations"];
        E -- "Needs Placeholder" --> G["Placeholder<br/>Handle missing information"];
        E -- "Ready to Synthesize" --> H["Synthesis<br/>Generate the final answer"];
        F --> H;
        G --> H;
    end
    
    H --> I["Memory Update<br/>Save key context for future turns"];
    I --> Z;
    
    classDef process fill:#f9f9f9,stroke:#333,stroke-width:2px,color:#000;
    classDef decision fill:#fff,stroke:#333,stroke-width:4px;
    classDef startend fill:#ccffcc,stroke:#333,stroke-width:2px;

    class A,Z startend;
    class B,C,D,E,F,G,H,I process;

    linkStyle default interpolate basis; 